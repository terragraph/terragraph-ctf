"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[600],{3905:(t,e,n)=>{n.d(e,{Zo:()=>d,kt:()=>k});var a=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},l=Object.keys(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var p=a.createContext({}),s=function(t){var e=a.useContext(p),n=e;return t&&(n="function"==typeof t?t(e):i(i({},e),t)),n},d=function(t){var e=s(t.components);return a.createElement(p.Provider,{value:e},t.children)},u={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},c=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,l=t.originalType,p=t.parentName,d=o(t,["components","mdxType","originalType","parentName"]),c=s(n),k=r,m=c["".concat(p,".").concat(k)]||c[k]||u[k]||l;return n?a.createElement(m,i(i({ref:e},d),{},{components:n})):a.createElement(m,i({ref:e},d))}));function k(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=n.length,i=new Array(l);i[0]=c;var o={};for(var p in e)hasOwnProperty.call(e,p)&&(o[p]=e[p]);o.originalType=t,o.mdxType="string"==typeof t?t:r,i[1]=o;for(var s=2;s<l;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},9243:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const l={},i="QoS Tests",o={unversionedId:"tests/QoS",id:"tests/QoS",title:"QoS Tests",description:"Introduction",source:"@site/../docs/tests/QoS.md",sourceDirName:"tests",slug:"/tests/QoS",permalink:"/terragraph-ctf/tests/QoS",draft:!1,editUrl:"https://github.com/terragraph/terragraph-ctf/edit/main/docs/../docs/tests/QoS.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Prefix Allocation (CPA/DPA) Tests",permalink:"/terragraph-ctf/tests/Prefix_Allocation"},next:{title:"Link Overloading Tests",permalink:"/terragraph-ctf/tests/Link_Overloading"}},p={},s=[{value:"Introduction",id:"introduction",level:2},{value:"Data Plane Operation and Traffic Models",id:"data-plane-operation-and-traffic-models",level:2},{value:"User Plane Traffic",id:"user-plane-traffic",level:3},{value:"Traffic with Fixed Packet Size",id:"traffic-with-fixed-packet-size",level:4},{value:"IMIX Traffic Models",id:"imix-traffic-models",level:4},{value:"IMIX Generation Model 1",id:"imix-generation-model-1",level:4},{value:"IMIX Generation Model 2",id:"imix-generation-model-2",level:4},{value:"Traffic Class Identification for User Plane Traffic",id:"traffic-class-identification-for-user-plane-traffic",level:4},{value:"Policing",id:"policing",level:3},{value:"2 rate / 3 color policing",id:"2-rate--3-color-policing",level:4},{value:"Upstream versus downstream policing",id:"upstream-versus-downstream-policing",level:4},{value:"Testing Defaults (Mostly Configuration)",id:"testing-defaults-mostly-configuration",level:2},{value:"VPP policer configuration:",id:"vpp-policer-configuration",level:3},{value:"Important Note for All Test Cases",id:"important-note-for-all-test-cases",level:3},{value:"Point to Point Test Cases - P2P1",id:"point-to-point-test-cases---p2p1",level:2},{value:"<code>QoS-P2P-1</code> Basic policer operation -- enforce CIR + EIR",id:"qos-p2p-1-basic-policer-operation----enforce-cir--eir",level:3},{value:"<code>QoS-P2P-2</code> Characterize basic delay measurements",id:"qos-p2p-2-characterize-basic-delay-measurements",level:3},{value:"<code>QoS-P2P-3</code> Characterize priority traffic delay with load",id:"qos-p2p-3-characterize-priority-traffic-delay-with-load",level:3},{value:"<code>QoS-P2P-4</code> Basic priority service with congestion response",id:"qos-p2p-4-basic-priority-service-with-congestion-response",level:3},{value:"<code>QoS-P2P-5</code> Basic priority service with time-varying congestion response",id:"qos-p2p-5-basic-priority-service-with-time-varying-congestion-response",level:3},{value:"<code>QoP2P-6</code> Policer remarking with TCP -- confirm packet order preserved",id:"qop2p-6-policer-remarking-with-tcp----confirm-packet-order-preserved",level:3},{value:"<code>QoS-P2P-7</code> Four traffic classes with strict priority service",id:"qos-p2p-7-four-traffic-classes-with-strict-priority-service",level:3},{value:"<code>QoS-P2P-8</code> Handling unknown DSCPs",id:"qos-p2p-8-handling-unknown-dscps",level:3},{value:"Point to Point Test Cases - P2P2",id:"point-to-point-test-cases---p2p2",level:2},{value:"<code>QoS-P2P-9</code> Single link performance test",id:"qos-p2p-9-single-link-performance-test",level:3},{value:"Point to Multipoint Test Cases - P2MP",id:"point-to-multipoint-test-cases---p2mp",level:2},{value:"<code>QoS-P2MP-1</code> Congestion control (per link, per TC)",id:"qos-p2mp-1-congestion-control-per-link-per-tc",level:3},{value:"<code>QoS-P2MP-2</code> P2MP performance test with cross traffic",id:"qos-p2mp-2-p2mp-performance-test-with-cross-traffic",level:3},{value:"<code>QoS-P2MP-3</code> P2MP single sector full load test",id:"qos-p2mp-3-p2mp-single-sector-full-load-test",level:3},{value:"Network Test Cases - NW1",id:"network-test-cases---nw1",level:2},{value:"<code>QoS-NW-1</code> Policing enforcement within mesh, downstream traffic",id:"qos-nw-1-policing-enforcement-within-mesh-downstream-traffic",level:3},{value:"<code>QoS-NW-2</code> Policing enforcement within mesh, upstream traffic",id:"qos-nw-2-policing-enforcement-within-mesh-upstream-traffic",level:3},{value:"Network Test Cases - NW2",id:"network-test-cases---nw2",level:2},{value:"<code>QoS-NW-3.1.1</code> Aggregate performance -- traffic profile 1",id:"qos-nw-311-aggregate-performance----traffic-profile-1",level:3},{value:"<code>QoS-NW-3.1.2</code> Aggregate performance -- traffic profile 2",id:"qos-nw-312-aggregate-performance----traffic-profile-2",level:3},{value:"<code>QoS-NW-3.1.3</code> Aggregate performance -- traffic profile 3",id:"qos-nw-313-aggregate-performance----traffic-profile-3",level:3},{value:"<code>QoS-NW-3.1.4</code> Aggregate performance -- traffic profile 4",id:"qos-nw-314-aggregate-performance----traffic-profile-4",level:3},{value:"<code>QoS-NW-4</code> Congestion control (per wireless SoC)",id:"qos-nw-4-congestion-control-per-wireless-soc",level:3}],d={toc:s};function u(t){let{components:e,...n}=t;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"qos-tests"},"QoS Tests"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"Consistent with the QoS requirements partially specified by the Puma PRD and by\nour data path design, a Terragraph DN must support the following:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Uplink traffic policing performed separately for each of 4 Traffic Classes:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Traffic marked to be within committed rate (CIR)"),(0,r.kt)("li",{parentName:"ol"},"Traffic marked to be in excess of committed rate (EIR) but below peak\nrate"),(0,r.kt)("li",{parentName:"ol"},"Traffic above peak rate shall be dropped"),(0,r.kt)("li",{parentName:"ol"},"CIR and EIR can be configured with different values for different Traffic\nClasses"))),(0,r.kt)("li",{parentName:"ol"},"Downlink traffic policing is expected to be done external to the Terragraph\nnetwork."),(0,r.kt)("li",{parentName:"ol"},"After policing, the Traffic Class and Drop Preference are indicated by the\nIPv6 header DSCP value. The mapping from Traffic Class and Drop Preference to\nDSCP value is configurable and identical for downlink and uplink traffic."),(0,r.kt)("li",{parentName:"ol"},"[Not specified in PRD but consistent with the implementation]"," At each TG\nsector, the 4 Traffic Classes are served according to a strict priority\npolicy \u2014 in this document, TC0 is the highest priority and TC3 is the lowest\npriority."),(0,r.kt)("li",{parentName:"ol"},"[Not specified clearly]"," Uplink traffic policing is required for ingress on\nthe 1G interface for both DN and CN operation. It is not required to support\nuplink traffic policing for ingress on the DN 10G interface. It is not yet\ndetermined whether the implementation will support policing on the 10G\ninterface; this test plan is defined assuming not."),(0,r.kt)("li",{parentName:"ol"},"[Not specific to QoS]"," According to the finalized Puma HW design, it is\nexpected that a single Puma DN can simultaneously sustain MCS 12 data rates\non 2 specific sectors and MCS 11 data rates on the 2 other specific sectors.\nAdditionally and specifically, the system will constrain the two relevant\nsectors to a maximum of MCS 11 at all times.")),(0,r.kt)("p",null,'The point of this test plan is to confirm the proper functionality of the QoS\nfunctions, which requires more elaborate traffic scenarios than many other types\nof validation tests. Many of the pass/fail criteria in this document include "~X\nMbps" to indicate "about X Mbps," based on what we should expect. The criteria\nhere are intentionally not specified to precisely account for various protocol\nand control traffic overheads -- that is not the intention for these acceptance\ntests.'),(0,r.kt)("p",null,"Note: All of the test setups in this document assume IF connections between TG\nsectors. If only RF connections are possible, it is fine to use RF connections\ninstead provided they can reliably support the expected PHY rates for each test\n(MCS 9, MCS 12, or as specified in the test)."),(0,r.kt)("h2",{id:"data-plane-operation-and-traffic-models"},"Data Plane Operation and Traffic Models"),(0,r.kt)("p",null,"Validation tests are based on two traffic models: IMIX and fixed rate traffic."),(0,r.kt)("h3",{id:"user-plane-traffic"},"User Plane Traffic"),(0,r.kt)("p",null,"User plane data traffic is generated using the following traffic models."),(0,r.kt)("h4",{id:"traffic-with-fixed-packet-size"},"Traffic with Fixed Packet Size"),(0,r.kt)("p",null,"In this traffic model, packet size will be fixed at 128 bytes or greater, up to\n1500 bytes. Any fixed packet size between 128 and 1500 bytes, inclusive, is\nallowed. Packet interarrivals may be constant or exponential (i.e. Poisson\narrivals). In both cases the arrival rate will be chosen to give the desired\ndata rate in Gbps or Mbps. Note: iPerf may be used to generate this traffic with\na fixed arrival rate."),(0,r.kt)("h4",{id:"imix-traffic-models"},"IMIX Traffic Models"),(0,r.kt)("p",null,"The following table contains the distribution of IMIX data used for acceptance:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Packet Size in Bytes (incl. IP Header)"),(0,r.kt)("th",{parentName:"tr",align:null},"Distribution (in packets)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"40"),(0,r.kt)("td",{parentName:"tr",align:null},"58.3333%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"576"),(0,r.kt)("td",{parentName:"tr",align:null},"33.3333%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1500"),(0,r.kt)("td",{parentName:"tr",align:null},"8.3333%")))),(0,r.kt)("p",null,"With an average packet size of 340 bytes, the packet rate for IMIX traffic to\nachieve 2 Gbps, for example, is approximately ~735Kpps."),(0,r.kt)("h4",{id:"imix-generation-model-1"},"IMIX Generation Model 1"),(0,r.kt)("p",null,"A hardware generator such as Ixia can be used to generate packets with a Poisson\narrival rate. The size of every arriving packet is random and is either 40, 576,\nor 1500 bytes with the size given by the probability distribution in the table\nabove. The arrival rate is chosen to give the desire data rate in Gbps or Mbps."),(0,r.kt)("h4",{id:"imix-generation-model-2"},"IMIX Generation Model 2"),(0,r.kt)("p",null,"In this model we mix 3 streams of constant size packets (given in the table\nabove). The ratios of the data rates for each stream is chosen to obtain the\nIMIX distribution. The absolute rate of each stream is chosen to give the\noverall desired rate. For example, to achieve a rate of approximately 2.5 Gbps,\nwe can generate three data flows with the following settings:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"For flow 1, generate packets at rate 535.6 KPPS with packet size 40 bytes"),(0,r.kt)("li",{parentName:"ol"},"For flow 2, generate packets at rate 306.1 KPPS with packet size 576 bytes"),(0,r.kt)("li",{parentName:"ol"},"For flow 3, generate packets at rate 76.5 KPPS with packet size 1500 bytes")),(0,r.kt)("p",null,"Note that the constant packet model does not test any burstiness brought by the\nIMIX model."),(0,r.kt)("h4",{id:"traffic-class-identification-for-user-plane-traffic"},"Traffic Class Identification for User Plane Traffic"),(0,r.kt)("p",null,"The requirement is to support strict priority between the Traffic Classes -- we\ndenote by TC0 the highest priority. With 4 Traffic Classes, TC3 denotes the\nlowest priority."),(0,r.kt)("p",null,"The classes are identified by the DSCP value in the IPv6 header. Additionally,\nrate policing is signaled using two different DSCP values for each Traffic\nClass, one signifying 'committed' traffic and the other 'excess' traffic (higher\ndrop preference). The mapping from DSCP to Traffic Class and Drop Preference\nmust be configurable. For testing, we use the following mapping from Traffic\nClass and Drop Preference to DSCP:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"QoS Class, Drop Preference"),(0,r.kt)("th",{parentName:"tr",align:null},"TC0, Low (Green)"),(0,r.kt)("th",{parentName:"tr",align:null},"TC0, High (Yellow)"),(0,r.kt)("th",{parentName:"tr",align:null},"TC1, Low (Green)"),(0,r.kt)("th",{parentName:"tr",align:null},"TC1, High (Yellow)"),(0,r.kt)("th",{parentName:"tr",align:null},"TC2, Low (Green)"),(0,r.kt)("th",{parentName:"tr",align:null},"TC2, High (Yellow)"),(0,r.kt)("th",{parentName:"tr",align:null},"TC3, Low (Green)"),(0,r.kt)("th",{parentName:"tr",align:null},"TC3, High (Yellow)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DSCP Value (Decimal)"),(0,r.kt)("td",{parentName:"tr",align:null},"34"),(0,r.kt)("td",{parentName:"tr",align:null},"36"),(0,r.kt)("td",{parentName:"tr",align:null},"26"),(0,r.kt)("td",{parentName:"tr",align:null},"28"),(0,r.kt)("td",{parentName:"tr",align:null},"18"),(0,r.kt)("td",{parentName:"tr",align:null},"20"),(0,r.kt)("td",{parentName:"tr",align:null},"10"),(0,r.kt)("td",{parentName:"tr",align:null},"12")))),(0,r.kt)("p",null,"Note: Logically this mapping can be arbitrary. This mapping is based on commonly\nused DiffServ mappings, with:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"(TC0, Green / Yellow) corresponding to 'AF41' /'AF42'"),(0,r.kt)("li",{parentName:"ul"},"(TC1, Green / Yellow) corresponding to 'AF31' / 'AF32'"),(0,r.kt)("li",{parentName:"ul"},"(TC2, Green / Yellow) corresponding to 'AF21' / 'AF22'"),(0,r.kt)("li",{parentName:"ul"},"(TC3, Green / Yellow) corresponding to 'AF11' / 'AF12'")),(0,r.kt)("p",null,"For traffic beyond a policer, all other DSCP values should be handled\nequivalently to TC3, Yellow -- i.e. the lowest priority. Ideally this will never\nhappen, but the implementation should handle it gracefully."),(0,r.kt)("h3",{id:"policing"},"Policing"),(0,r.kt)("h4",{id:"2-rate--3-color-policing"},"2 rate / 3 color policing"),(0,r.kt)("p",null,"According to QoS requirements, policing is done separately per Traffic Class. By\ndefinition, the policing function is a 2 rate / 3 color policer. Traffic\nconforming to the lower rate is considered 'green', corresponding to low drop\npreference (last to be dropped from that Traffic Class). Traffic beyond 'green'\nand conforming to the higher rate is considered 'yellow', corresponding to\nhigher drop preference (dropped before 'green' traffic). Traffic beyond 'green'\nand 'yellow' is considered 'red' and must not be forwarded to another TG sector."),(0,r.kt)("p",null,"Traffic inbound to a policing function that has an unknown DSCP value must be\nconsidered equivalent to TC3, Green."),(0,r.kt)("h4",{id:"upstream-versus-downstream-policing"},"Upstream versus downstream policing"),(0,r.kt)("p",null,"Traffic inbound from a user device attached to a TG node is considered upstream\ntraffic, and this is required only on a 1G interface / port. Traffic inbound to\nthe TG network from a POP node toward a user device is considered downstream\ntraffic and is expected on a 10G interface / port."),(0,r.kt)("p",null,"Upstream traffic must be policed on the TG node to which it is attached.\nPolicing corresponds to applying the 2 rate / 3 color policing function\nconfigured for that user device and Traffic Class. At ingress to the TG node,\nthe upstream traffic is expected to be marked with DSCP corresponding to one of\nthe supported Traffic Classes with low drop preference (Green). Depending on the\ninbound rate and corresponding policing function configuration, some traffic\nwill pass unmodified, some traffic potentially will have DSCP remarked to the\ncorresponding 'Yellow' color of that Traffic Class, and some traffic potentially\ndropped within the node due to exceeding the second configured policing function\nrate, i.e. being 'Red'."),(0,r.kt)("p",null,"Downstream traffic is not policed directly within the TG (DN POP) node. The\npolicing function is instead applied within the core network edge router (or\nbefore). It is expected to be properly marked by DSCP according to one of the\nsupported Traffic Classes and Drop Preferences. In this test plan, we assume the\ntraffic generators do not have internal 2 rate / 3 color policing functionality\nbut can generate traffic with different specified DSCPs. Therefore, for\ndownstream traffic of a particular Traffic Class, we generate downstream 'Green'\nand 'Yellow' traffic independently and in parallel. This prevents us from easily\ntesting any downstream scenario with congestion for a Traffic Class carrying TCP\ntraffic -- the traffic source will not be able to produce a single TCP stream\nwith a mix of Green and Yellow traffic."),(0,r.kt)("h2",{id:"testing-defaults-mostly-configuration"},"Testing Defaults (Mostly Configuration)"),(0,r.kt)("p",null,"Unless otherwise specified in a particular test:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"UDP traffic with fixed size packets of size 512 bytes, and fixed packet\ninter-arrivals determined by the offered traffic throughput (TCP traffic will\nbe used heavily for general testing but limited for QoS tests).",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"There is a known core data plane packet processing limitation of\napproximately 450kPPS for traffic routed from WiGig to WiGig interfaces.\nUntil this known PPS limitation is improved, we should apply the\nfollowing:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"1150B payload size (or larger) for multi-hop bidirectional tests"),(0,r.kt)("li",{parentName:"ol"},"800B payload size (or larger) for multi-hop unidirectional tests"),(0,r.kt)("li",{parentName:"ol"},"These should work for multihop tests where TG nodes have at most 2\nsectors handling traffic, and should work for single hop tests with\nyet more headroom."))))),(0,r.kt)("li",{parentName:"ol"},"When not using precision test equipment to characterize delay, ",(0,r.kt)("inlineCode",{parentName:"li"},"iperf3"),"\nshould be used."),(0,r.kt)("li",{parentName:"ol"},"Upstream policing function for each Traffic Class:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Configured as ",(0,r.kt)("a",{parentName:"li",href:"https://tools.ietf.org/html/rfc4115"},"RFC 4115"),", which\nincludes the following configuration parameters:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Green / CIR = 300 Mbps."),(0,r.kt)("li",{parentName:"ol"},"Yellow / EIR = 700 Mbps."),(0,r.kt)("li",{parentName:"ol"},"CBS = TBD (may have to tune during testing). This parameter is\n'Committed Burst Size', defining the token bucket size (in bytes)\nused for marking CIR traffic."),(0,r.kt)("li",{parentName:"ol"},"EBS = TBD (may have to tune during testing). This is 'Excess Burst\nSize', defining the token bucket size (in bytes) used for marking EIR\ntraffic."))))),(0,r.kt)("li",{parentName:"ol"},"Test traffic run for 180 seconds. When verifying throughputs, ignore the\nfirst 5 seconds after traffic is started so that we measure the performance\nin steady state, consistent with how we typically test and verify Terragraph\nsystem performance (specifically, ignore traffic for the same amount of time\nas we typically do for testing, if not 5 seconds)."),(0,r.kt)("li",{parentName:"ol"},"All tests in this test plan fix MCS in order to provide predictable pass/fail\ncriteria for the different traffic class streams. Transmit power shall also\nbe fixed (appropriate for the physical setup) to avoid introducing PER."),(0,r.kt)("li",{parentName:"ol"},"Some of these tests are based on MCS = 6. We originally expected this MCS to\nyield approximately 750 Mbps bidirectional throughput for UDP. Based on the\nextra hugging and the changes in throughput from Qualcomm, the expected MCS 6\nrate is 587 Mbps for UDP. To confirm, we measured 602 Mbps in the lab.\nTherefore we modified all tests based on MCS = 6 in this document to assume\n590 Mbps bidirectional throughput for UDP."),(0,r.kt)("li",{parentName:"ol"},"Average packet delay, average delay jitter, and histogram of packet delay\nshould be captured for each separate traffic flow as part of test results, if\nthe test equipment permits. We will need to make an engineering judgment call\nwhether the results are acceptable."),(0,r.kt)("li",{parentName:"ol"},'Many tests indicate \u201cverify ~ X Mbps" for a traffic flow. To be precise,\ndefine the pass / fail criterion as at least 90% of X Mbps.')),(0,r.kt)("h3",{id:"vpp-policer-configuration"},"VPP policer configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"/usr/bin/tg_vpp_cfg -c /etc/vpp/vpp_config.json -t -i \\\n  -p policer_add_del_tc0 \\\n  -p policer_add_del_tc1 \\\n  -p policer_add_del_tc2 \\\n  -p policer_add_del_tc3 \\\n  -s classify_add_del_session_tc0_af4 \\\n  -s classify_add_del_session_tc1_af3 \\\n  -s classify_add_del_session_tc2_af2 \\\n  -s classify_add_del_session_tc3_af1\n")),(0,r.kt)("p",null,"The default config is stored in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/vpp/vpp_config.json")," and the above command\nwill apply the QoS policer config stored in the JSON. Please note that PIR\nshould be EIR + CIR (= PIR) and you should expect a receive rate of PIR."),(0,r.kt)("h3",{id:"important-note-for-all-test-cases"},"Important Note for All Test Cases"),(0,r.kt)("p",null,"This test plan assumes WRED is implemented for queue congestion management,\nwhich allows us to distinguish between CIR vs. EIR traffic during congestion.\nThis will not meet our end requirements, but it will have a lot of new\nfunctionality that we should test and debug \u2014 max rate limiting per Traffic\nClass to CIR+EIR, and Strict Priority scheduling. For that interim\nimplementation, we can modify every test case by changing 'Verify on receive' \u2014\nspecifically, change to verify only the sum of the specified expected Green +\nYellow (separately for each Traffic Class). For example, if a test indicates:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC1 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100"),(0,r.kt)("td",{parentName:"tr",align:null},"100, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC1 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"175"),(0,r.kt)("td",{parentName:"tr",align:null},"175, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC2 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"150"),(0,r.kt)("td",{parentName:"tr",align:null},"150, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC2 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"125"),(0,r.kt)("td",{parentName:"tr",align:null},"~50")))),(0,r.kt)("p",null,"For the interim tail drop implementation, we would modify to:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC1 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100"),(0,r.kt)("td",{parentName:"tr",align:null},"275 Green + Yellow, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC1 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"175"),(0,r.kt)("td",{parentName:"tr",align:null},"275 Green + Yellow, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC2 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"150"),(0,r.kt)("td",{parentName:"tr",align:null},"~200 Green + Yellow")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC2 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"125"),(0,r.kt)("td",{parentName:"tr",align:null},"~200 Green + Yellow")))),(0,r.kt)("h2",{id:"point-to-point-test-cases---p2p1"},"Point to Point Test Cases - P2P1"),(0,r.kt)("p",null,"For some Point to Point tests, we use the following IF setup, denoted ",(0,r.kt)("strong",{parentName:"p"},"P2P1"),":"),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{src:"/terragraph-ctf/figures/QoS-P2P1.png",width:"800"})),(0,r.kt)("p",null,"The connection between DN0 and CN/DN1 is an IF connection. In this diagram 'CN'\nmeans Puma configured to operate as a CN. 'DN1' means Puma configured to operate\nas a DN."),(0,r.kt)("h3",{id:"qos-p2p-1-basic-policer-operation----enforce-cir--eir"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-P2P-1")," Basic policer operation -- enforce CIR + EIR"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2P1")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix lamaxMCS = 9, yielding approximately 1 Gbps bidirectional throughput on\nthat link")),(0,r.kt)("p",null,"CN/DN1 node configured as CN"),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"TC0: 50 Mbps / 150 Mbps"),(0,r.kt)("li",{parentName:"ul"},"TC3: 150 Mbps / 150 Mbps")),(0,r.kt)("p",null,"Note on iPerf:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"iperf -S 0x88")," \u2192 TOS = 0x88 \u2192 AF41 \u2192 TC0"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"iperf -S 0x28")," \u2192 TOS = 0x28 \u2192 AF11 \u2192 TC3")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"300"),(0,r.kt)("td",{parentName:"tr",align:null},"~200, Green + Yellow")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"500"),(0,r.kt)("td",{parentName:"tr",align:null},"~300, Green + Yellow")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"From stats: Verify dropped packet counters (on CN, due to policing function)\nappear to increase at the appropriate rate. Verify similarly for TC3 traffic.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Repeat the test with CN/DN1 node configured to operate as a DN (with the same\npolicer configuration for DN1).")),(0,r.kt)("h3",{id:"qos-p2p-2-characterize-basic-delay-measurements"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-P2P-2")," Characterize basic delay measurements"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2P1")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix lamaxMCS = 12, yielding approximately 1.8 Gbps bidirectional throughput on\nthat link",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Note: ensure we are using Puma sectors that can support MCS = 12.")))),(0,r.kt)("p",null,"CN/DN1 node configured as CN"),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Default (irrelevant -- not exercised in this test)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Using precision test equipment")," (e.g., Ixia), traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 kbs with 100B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"No packet loss, average 1-way latency < 1 msec")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 kbs with 100B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"No packet loss, average 1-way latency < 1 msec")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 kbs with 100B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"No packet loss, average 1-way latency < 1 msec")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 kbs with 100B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"No packet loss, average 1-way latency < 1 msec")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For this test, we will need to make an engineering judgment call whether the\nabsolute 1-way latency average and standard deviations are acceptable.")),(0,r.kt)("h3",{id:"qos-p2p-3-characterize-priority-traffic-delay-with-load"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-P2P-3")," Characterize priority traffic delay with load"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2P1")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 12, yielding approximately 1.8 Gbps bidirectional throughput on that link",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Note: ensure we are using Puma sectors that can support MCS = 12.")))),(0,r.kt)("p",null,"CN/DN1 node configured as CN"),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Default (irrelevant -- not exercised in this test)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Using precision test equipment")," (e.g., Ixia), traffic simultaneous send /\nverify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 kbs with 100B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"No packet loss, average 1-way latency < 1 msec")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 kbs with 100B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"No packet loss, average 1-way latency < 1 msec")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 kbs with 100B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"No packet loss, average 1-way latency < 1 msec")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"2 Gbps with 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"~ 1.8 Gbps")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For this test, we will need to make an engineering judgment call whether the\nabsolute 1-way latency average and standard deviations are acceptable."),(0,r.kt)("li",{parentName:"ul"},"Given the current data plane architecture and configuration, we should expect\nthat average 1-way latency for DN0 to CN, TC0 Green should expect < 2 msec\nlatency (rather than 1 msec). With this traffic profile, 1-way latency in the\nopposite direction (CN to DN0) should be low. Therefore if we use ping to\nmeasure round-trip latency rather than Ixia, we should pass if TC0 ping RTT <\n2.5 msec.")),(0,r.kt)("h3",{id:"qos-p2p-4-basic-priority-service-with-congestion-response"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-P2P-4")," Basic priority service with congestion response"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2P1")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 6, yielding approximately 590 Mbps bidirectional throughput (see\nnote in Testing Defaults)")),(0,r.kt)("p",null,"CN/DN1 node configured as CN"),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"TC0: 50 Mbps / 950 Mbps"),(0,r.kt)("li",{parentName:"ul"},"TC3: 300 Mbps / 700 Mbps")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"200"),(0,r.kt)("td",{parentName:"tr",align:null},"200, Green +  Yellow, no packet loss",(0,r.kt)("br",null),"(50 Mbps Green; 150 Mbps Yellow)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"700"),(0,r.kt)("td",{parentName:"tr",align:null},"~ 390, Green + Yellow",(0,r.kt)("br",null),"Note: OK to be ~12 Mbps higher due to MCS = 6 getting ~602 Mbps (measured) rather than 590 Mbps (predicted)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"50"),(0,r.kt)("td",{parentName:"tr",align:null},"50, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC0 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"150"),(0,r.kt)("td",{parentName:"tr",align:null},"150, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"300"),(0,r.kt)("td",{parentName:"tr",align:null},"300, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC3 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"500 Mbps"),(0,r.kt)("td",{parentName:"tr",align:null},"~ 90",(0,r.kt)("br",null),"Note: OK to be ~12 Mbps higher due to MCS = 6 getting ~602 Mbps (measured) rather than 590 Mbps (predicted)")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"From stats, verify dropped packet counters for TC3 on both CN and DN0 (due to\ncongestion)."),(0,r.kt)("li",{parentName:"ul"},"Repeat the test with DN0 to CN, TC3 Yellow of 2000 Mbps rather than 500 Mbps \u2014\nsame expected throughput to verify.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Repeat with CN/DN1 node configured to operate as a DN (with the same policer\nconfiguration for DN1).")),(0,r.kt)("h3",{id:"qos-p2p-5-basic-priority-service-with-time-varying-congestion-response"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-P2P-5")," Basic priority service with time-varying congestion response"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2P1")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 6, yielding approximately 590 Mbps bidirectional throughput (see\nnote in Testing Defaults)")),(0,r.kt)("p",null,"CN/DN1 node configured as CN"),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Default (irrelevant -- not exercised in this test)")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"150"),(0,r.kt)("td",{parentName:"tr",align:null},"150, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"300"),(0,r.kt)("td",{parentName:"tr",align:null},"300, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC3 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"Repeat 5 iterations:",(0,r.kt)("br",null),"1. 100 for 30 seconds, then",(0,r.kt)("br",null),"2. 550 for 30 seconds"),(0,r.kt)("td",{parentName:"tr",align:null},"100 when sending 100, and ~140 when sending 550",(0,r.kt)("br",null),"Note: OK to be ~12 Mbps higher due to MCS = 6 getting ~602 Mbps (measured) rather than 590 Mbps (predicted)")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The intention of this test is to verify that the queue drop policy responds\nproperly to the change in congestion state for a particular Traffic Class, and\nthe other Traffic Class traffic is not affected in any way.")),(0,r.kt)("h3",{id:"qop2p-6-policer-remarking-with-tcp----confirm-packet-order-preserved"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoP2P-6")," Policer remarking with TCP -- confirm packet order preserved"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2P1")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 9, yielding approximately 1 Gbps bidirectional throughput")),(0,r.kt)("p",null,"CN/DN1 node configured as CN"),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"TC0: 50 Mbps / 950 Mbps"),(0,r.kt)("li",{parentName:"ul"},"TC3: 300 Mbps / 700 Gbps")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"200 TCP"),(0,r.kt)("td",{parentName:"tr",align:null},"200, Green + Yellow")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"700 TCP"),(0,r.kt)("td",{parentName:"tr",align:null},"700, Green + Yellow")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Repeat with CN/DN1 node configured to operate as a DN (with the same policer\nconfiguration for DN1).")),(0,r.kt)("h3",{id:"qos-p2p-7-four-traffic-classes-with-strict-priority-service"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-P2P-7")," Four traffic classes with strict priority service"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2P1")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 6, yielding approximately 590 Mbps bidirectional throughput (see\nnote in Testing Defaults)")),(0,r.kt)("p",null,"CN/DN1 node configured as CN"),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"TC0: 50 Mbps / 400 Mbps"),(0,r.kt)("li",{parentName:"ul"},"TC1: 100 Mbps / 400 Mbps"),(0,r.kt)("li",{parentName:"ul"},"TC2: 150 Mbps / 400 Mbps"),(0,r.kt)("li",{parentName:"ul"},"TC3: 200 Mbps / 400 Mbps")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"225"),(0,r.kt)("td",{parentName:"tr",align:null},"225, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC1 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"225"),(0,r.kt)("td",{parentName:"tr",align:null},"225, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC2 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"225"),(0,r.kt)("td",{parentName:"tr",align:null},"~140",(0,r.kt)("br",null),"Note: OK to be ~12 Mbps higher due to MCS = 6 getting ~602 Mbps (measured) rather than 590 Mbps (predicted)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"75"),(0,r.kt)("td",{parentName:"tr",align:null},"~0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"50"),(0,r.kt)("td",{parentName:"tr",align:null},"50, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC0 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"100"),(0,r.kt)("td",{parentName:"tr",align:null},"100, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC1 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100"),(0,r.kt)("td",{parentName:"tr",align:null},"100, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC1 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"140"),(0,r.kt)("td",{parentName:"tr",align:null},"140, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC2 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"150"),(0,r.kt)("td",{parentName:"tr",align:null},"150, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC2 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"125"),(0,r.kt)("td",{parentName:"tr",align:null},"~50",(0,r.kt)("br",null),"Note: OK to be ~12 Mbps higher due to MCS = 6 getting ~602 Mbps (measured) rather than 590 Mbps (predicted)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"170"),(0,r.kt)("td",{parentName:"tr",align:null},"0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC3 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"0",(0,r.kt)("br",null),"(just for completeness -- 0 is correct)"),(0,r.kt)("td",{parentName:"tr",align:null},"0")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Repeat with CN/DN1 node configured to operate as a DN (with the same policer\nconfiguration for DN1).")),(0,r.kt)("h3",{id:"qos-p2p-8-handling-unknown-dscps"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-P2P-8")," Handling unknown DSCPs"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2P1")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 9, yielding approximately 1 Gbps bidirectional throughput on that\nlink")),(0,r.kt)("p",null,"CN/DN1 node configured as CN"),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"TC0: 50 Mbps / 150 Mbps"),(0,r.kt)("li",{parentName:"ul"},"TC3: 150 Mbps / 350 Mbps")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"300"),(0,r.kt)("td",{parentName:"tr",align:null},"200, Green + Yellow")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"300"),(0,r.kt)("td",{parentName:"tr",align:null},"500, Green + Yellow")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN to DN0, Unknown DSCP (use DSCP = 17)"),(0,r.kt)("td",{parentName:"tr",align:null},"300"),(0,r.kt)("td",{parentName:"tr",align:null},"500, Green + Yellow")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"150"),(0,r.kt)("td",{parentName:"tr",align:null},"150, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC0 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"150"),(0,r.kt)("td",{parentName:"tr",align:null},"150, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"300"),(0,r.kt)("td",{parentName:"tr",align:null},"300, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, TC3 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"500"),(0,r.kt)("td",{parentName:"tr",align:null},"~ 200")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN, Unknown DSCP (use DSCP = 17)"),(0,r.kt)("td",{parentName:"tr",align:null},"500"),(0,r.kt)("td",{parentName:"tr",align:null},"~ 200")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For downstream traffic, an unknown DSCP is expected to be handled equivalently\nto lowest priority traffic with high drop preference \u2014 i.e. TC3 Yellow\ntraffic. The DSCP value is not expected to be changed."),(0,r.kt)("li",{parentName:"ul"},"For upstream traffic, an unknown DSCP is expected to never occur once the\ntransmit path Network Integration Function is in place (one aspect is the\nresponsibility to set the DSCP to one of the expected values). Regardless,\nshould it occur, the implementation is expected to handle this equivalently to\nlowest priority traffic with low drop preference \u2014 i.e. TC3 Green traffic \u2014\nwhich is then subject to the TC3 policing function. The DSCP value is expected\nto be changed.")),(0,r.kt)("h2",{id:"point-to-point-test-cases---p2p2"},"Point to Point Test Cases - P2P2"),(0,r.kt)("p",null,"For some Point to Point tests, we use the following IF setup, denoted ",(0,r.kt)("strong",{parentName:"p"},"P2P2"),":"),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{src:"/terragraph-ctf/figures/QoS-P2P2.png",width:"800"})),(0,r.kt)("p",null,"The connection between DN0 and DN1 is an IF connection. Note the only difference\nbetween P2P1 and P2P2 is that P2P2 has two DN sectors, each with the external\ntraffic source connected to its 10G interface."),(0,r.kt)("h3",{id:"qos-p2p-9-single-link-performance-test"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-P2P-9")," Single link performance test"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2P2")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 12, yielding approximately 1.8 Gbps bidirectional throughput",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Note: ensure we are using Puma sectors that can support MCS = 12.")))),(0,r.kt)("p",null,"DN policer configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"N/A (irrelevant -- no end devices attached to GigE ports)")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to DN1, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"1800 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"1800, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN1 to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"1800 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"1800, no packet loss")))),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Repeat with TCP at max rate 1800 Mbps and verify ~ 1800 Mbps in each\ndirection."),(0,r.kt)("li",{parentName:"ol"},"Repeat with TC3 Green TCP at max rate 1500 Mbps + TC1 Green UDP at rate 100\nMbps. Verify aggregate ~ 1600 Mbps each direction and no UDP packet loss.",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Note: we use an aggregate 1600 Mbps to ensure the TC3 queue does not back\nup and drop TCP packets, which would cause TCP to back off. The pass /\nfail criteria would be less clear in this case.")))),(0,r.kt)("h2",{id:"point-to-multipoint-test-cases---p2mp"},"Point to Multipoint Test Cases - P2MP"),(0,r.kt)("p",null,"For Point to Multipoint tests, we use the following IF setup, denoted ",(0,r.kt)("strong",{parentName:"p"},"P2MP"),":"),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{src:"/terragraph-ctf/figures/QoS-P2MP.png",width:"800"})),(0,r.kt)("p",null,"DN0 has a single sector connected to the two CNs, or 1 CN and 1 DN, in a P2MP\nconfiguration."),(0,r.kt)("h3",{id:"qos-p2mp-1-congestion-control-per-link-per-tc"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-P2MP-1")," Congestion control (per link, per TC)"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2MP")),(0,r.kt)("p",null,"Channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 9 on both links, yielding a little less than 1 Gbps bidirectional\nthroughput through DN0")),(0,r.kt)("p",null,"CN1/DN1 node configured as CN"),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Default configuration")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN1, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"150"),(0,r.kt)("td",{parentName:"tr",align:null},"150, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN1, TC3 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"150"),(0,r.kt)("td",{parentName:"tr",align:null},"150, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN2, TC1 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"200"),(0,r.kt)("td",{parentName:"tr",align:null},"200, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN2, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"200"),(0,r.kt)("td",{parentName:"tr",align:null},"200, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN2, TC3 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"1000"),(0,r.kt)("td",{parentName:"tr",align:null},"~250-300")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The intention of this test is to confirm that congestion in the DN0 queue(s)\nfor CN2 does not cause packet drops in the data path on DN0 for CN1.")),(0,r.kt)("h3",{id:"qos-p2mp-2-p2mp-performance-test-with-cross-traffic"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-P2MP-2")," P2MP performance test with cross traffic"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2MP")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 12 on both links, yielding approximately 1.8 Gbps bidirectional\nthroughput capacity (aggregate for the links)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Note: ensure we are using Puma sectors that can support MCS = 12.")))),(0,r.kt)("p",null,"CN1/DN1 node configured as CN"),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Default configuration")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN1 to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"850 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"~800, Green + Yellow")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN2 to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"850 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"~800, Green + Yellow")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN1 to CN2, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"100, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN2 to CN1, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"100, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN1, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"100, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN1, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"850 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"~700")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN2, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"100, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN2, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"850 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"~700")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The intention of this test is to verify that the high priority traffic\nreceived from CN1 and destined to CN2 is classified and multiplexed properly\non DN0 with the ingress traffic on DN0 destined to CN2. And similarly for\ntraffic destined to CN1.")),(0,r.kt)("h3",{id:"qos-p2mp-3-p2mp-single-sector-full-load-test"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-P2MP-3")," P2MP single sector full load test"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"P2MP extended to 8 CNs")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 12 on all 8 links, yielding approximately 1.8 Gbps bidirectional\nthroughput capacity (aggregate for the links, and under the right traffic\nconditions)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Note: ensure we are using Puma sectors that can support MCS = 12."),(0,r.kt)("li",{parentName:"ul"},"Note 2: this assumes that Puma can support 1.8 Gbps bidirectional in\nanalogous test conditions without QoS.")))),(0,r.kt)("p",null,"CN1/DN1 node configured as CN"),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Default configuration")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Each CN to DN0, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"50 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"50, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Each CN to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"150 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"150, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to each CN, TC0 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"100, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to each CN, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"300 with fixed 1500B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"~125")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The intention of this test is to verify that for a single sector, the buffer\nmanagement on DN0 can scale to handle the parallel load for 8 CNs with a mix\nof low and high priority traffic."),(0,r.kt)("li",{parentName:"ul"},"The aggregate UL traffic is 1.6 Gbps in this test, a bit below the\napproximate maximum 1.8 Gbps. The intention is to stress the DL data plane and\nbuffer management, triggering drops due to DL congestion, while also verifying\nno loss in the UL receive path."),(0,r.kt)("li",{parentName:"ul"},"If Puma cannot support 1.8 Gbps in a P2MP setup with 8 CNs without QoS, then\nfor this test we should scale back the aggregate DL traffic accordingly.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Repeat with TC1 in place of TC0 and TC2 in place of TC3.")),(0,r.kt)("h2",{id:"network-test-cases---nw1"},"Network Test Cases - NW1"),(0,r.kt)("p",null,"For some Network tests, we use the following IF setup, denoted ",(0,r.kt)("strong",{parentName:"p"},"NW1"),":"),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{src:"/terragraph-ctf/figures/QoS-NW1.png",width:"800"})),(0,r.kt)("p",null,"In this network, there are only point-to-point links -- one connected (IF) to\nDN0, a second to CN1, and the third to CN2."),(0,r.kt)("h3",{id:"qos-nw-1-policing-enforcement-within-mesh-downstream-traffic"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-NW-1")," Policing enforcement within mesh, downstream traffic"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"NW1")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 9 on all three links, yielding a little less than 1 Gbps\nbidirectional throughput on each link.")),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Default configuration")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN1, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"300"),(0,r.kt)("td",{parentName:"tr",align:null},"300, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN2, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"300"),(0,r.kt)("td",{parentName:"tr",align:null},"300, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN0 to CN2, TC3 Yellow"),(0,r.kt)("td",{parentName:"tr",align:null},"600"),(0,r.kt)("td",{parentName:"tr",align:null},"~400")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Confirm no packet loss on DN1 (nothing specific to QoS functionality).")),(0,r.kt)("h3",{id:"qos-nw-2-policing-enforcement-within-mesh-upstream-traffic"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-NW-2")," Policing enforcement within mesh, upstream traffic"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"NW1")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 9 on all three links, yielding a little less than 1 Gbps\nbidirectional throughput on each link.")),(0,r.kt)("p",null,"CN policer CIR / EIR configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Default configuration")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN1 to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"300"),(0,r.kt)("td",{parentName:"tr",align:null},"300, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CN2 to DN0, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"900"),(0,r.kt)("td",{parentName:"tr",align:null},"~700, Green + Yellow")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Confirm no packet loss on DN1 (nothing specific to QoS functionality).")),(0,r.kt)("h2",{id:"network-test-cases---nw2"},"Network Test Cases - NW2"),(0,r.kt)("p",null,"For some Network tests, we use the following IF setup, denoted ",(0,r.kt)("strong",{parentName:"p"},"NW2"),":"),(0,r.kt)("p",{align:"center"},(0,r.kt)("img",{src:"/terragraph-ctf/figures/QoS-NW2.png",width:"800"})),(0,r.kt)("p",null,"In this network, there are only point-to-point links. DN0 has 4 sectors -- one\nconnected (IF) to each of 4 other DNs."),(0,r.kt)("h3",{id:"qos-nw-311-aggregate-performance----traffic-profile-1"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-NW-3.1.1")," Aggregate performance -- traffic profile 1"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"NW2")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS to maximum on all 4 links (for DN0: 2 at MCS = 12, 2 at MCS = 11),\nyielding approximately 1.8 Gbps bidirectional throughput on each MCS = 12 link\nand approximately 1.5 Gbps bidirectional throughput on each MCS=11 link.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Note: ensure the MCS = 12 links on DN0 are aligned with links that support\nMCS = 12 on the other end.")))),(0,r.kt)("p",null,"DN policer configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"N/A (irrelevant -- no end devices attached to GigE ports)")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN1 to DN3, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"1500 with fixed 512B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"1500, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN2 to DN4, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"1500 with fixed 512B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"1500, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN3 to DN2, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"1500 with fixed 512B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"1500, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN4 to DN1, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"1500 with fixed 512B packets"),(0,r.kt)("td",{parentName:"tr",align:null},"1500, no packet loss")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"This traffic load is consistent with the initial aggregate traffic capability\nfor Puma."),(0,r.kt)("li",{parentName:"ul"},"From what we understand about the QCOM A-MSDU aggregation logic, using 512B\npackets will limit the system to 1.31 Gbps on each link (rather than the 1500\nMbps indicated). This test, ",(0,r.kt)("inlineCode",{parentName:"li"},"QoS-NW-3.1.1")," is actually not a QoS test \u2014 it is\nintended to be used as a baseline for later test(s).")),(0,r.kt)("h3",{id:"qos-nw-312-aggregate-performance----traffic-profile-2"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-NW-3.1.2")," Aggregate performance -- traffic profile 2"),(0,r.kt)("p",null,"Repeat ",(0,r.kt)("inlineCode",{parentName:"p"},"NW-3.1.1")," with the following changes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Send 150 Mbps TC0 Green + 1350 Mbps TC3 Green for each flow."),(0,r.kt)("li",{parentName:"ul"},"Verify no TC0 Green traffic is dropped, and the same total throughput is\ndelivered to each DN as in ",(0,r.kt)("inlineCode",{parentName:"li"},"QoS-NW-3.1.1"),".")),(0,r.kt)("h3",{id:"qos-nw-313-aggregate-performance----traffic-profile-3"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-NW-3.1.3")," Aggregate performance -- traffic profile 3"),(0,r.kt)("p",null,"Repeat ",(0,r.kt)("inlineCode",{parentName:"p"},"NW-3.1.1")," with the following changes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Generate traffic using IMIX Model 2. This traffic model is defined above in\nthis document.")),(0,r.kt)("p",null,"Note: This traffic mix is consistent with the packet forwarding performance\ntraffic mix in the PRD. However, it is not explicitly expected to be achievable\nfor Puma."),(0,r.kt)("h3",{id:"qos-nw-314-aggregate-performance----traffic-profile-4"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-NW-3.1.4")," Aggregate performance -- traffic profile 4"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"NW2")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS to maximum on all 4 links (for DN0: 2 at MCS = 12, 2 at MCS = 11),\nyielding approximately 1.8 Gbps bidirectional throughput on each MCS = 12 link\nand approximately 1.5 Gbps bidirectional throughput on each MCS=11 link.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Note: ensure the MCS = 12 links on DN0 are aligned with links that support\nMCS = 12 on the other end.")))),(0,r.kt)("p",null,"DN policer configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"N/A (irrelevant -- no end devices attached to GigE ports)")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN1 to DN3, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"1800 with IMIX Model 2"),(0,r.kt)("td",{parentName:"tr",align:null},"1800, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN2 to DN4, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"1500 with IMIX Model 2"),(0,r.kt)("td",{parentName:"tr",align:null},"1500, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN3 to DN1, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"1800 with IMIX Model 2"),(0,r.kt)("td",{parentName:"tr",align:null},"1800, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN4 to DN2, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"1500 with IMIX Model 2"),(0,r.kt)("td",{parentName:"tr",align:null},"1500, no packet loss")))),(0,r.kt)("p",null,"Note: This traffic profile is consistent with the final aggregate traffic\ncapability for Puma based on the PRD. This is not expected to be achievable.\nAdditionally, based on the A-MSDU aggregation logic within Talyn2, that logic\nwill also limit us below these PRD rates."),(0,r.kt)("h3",{id:"qos-nw-4-congestion-control-per-wireless-soc"},(0,r.kt)("inlineCode",{parentName:"h3"},"QoS-NW-4")," Congestion control (per wireless SoC)"),(0,r.kt)("p",null,"Physical setup: ",(0,r.kt)("strong",{parentName:"p"},"NW2")),(0,r.kt)("p",null,"IF channel configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fix MCS = 9 on all four links, yielding approximately 1 Gbps bidirectional\nthroughput on each link.")),(0,r.kt)("p",null,"DN policer configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"N/A (irrelevant -- no end devices attached to GigE ports)")),(0,r.kt)("p",null,"Traffic simultaneous send / verify receive:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Traffic dir and type"),(0,r.kt)("th",{parentName:"tr",align:null},"Send (Mbps)"),(0,r.kt)("th",{parentName:"tr",align:null},"Verify on receive (Mbps)"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN1 to DN4, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"800"),(0,r.kt)("td",{parentName:"tr",align:null},"~500")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN2 to DN4, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"800"),(0,r.kt)("td",{parentName:"tr",align:null},"~500")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN2 to DN1, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"100"),(0,r.kt)("td",{parentName:"tr",align:null},"100, no packet loss")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DN3 to DN1, TC3 Green"),(0,r.kt)("td",{parentName:"tr",align:null},"800"),(0,r.kt)("td",{parentName:"tr",align:null},"800, no packet loss")))),(0,r.kt)("p",null,"Notes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"This is a multi-hop test. There is a known core data plane packet processing\nlimitation of approximately 450kPPS for traffic routed from WiGig to WiGig\ninterfaces. For this test, until this known PPS limitation is improved, we\nshould run with 800B packets rather than 500B packets. This is the general\nrecommendation for SIT testing.")))}u.isMDXComponent=!0}}]);